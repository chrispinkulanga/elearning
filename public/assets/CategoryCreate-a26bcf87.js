import{g as N,U as T,r as O,G as S,H as $,h as q,i as u,c as m,b as o,e as B,w as A,j as b,q as M,J as p,K as g,n as z,t as y,d as f,M as I}from"./index-367fd436.js";const R={class:"min-h-screen bg-gray-50 py-8"},G={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},H={class:"mb-8"},J={class:"flex items-center justify-between"},K={class:"bg-white rounded-lg shadow-sm"},L={key:0,class:"mt-1 text-sm text-red-600"},Y={key:0,class:"mt-1 text-sm text-red-600"},Q={class:"flex items-center space-x-3"},W={key:0,class:"mt-1 text-sm text-red-600"},X={class:"flex justify-end space-x-3 pt-6 border-t border-gray-200"},Z=["disabled"],ee={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},te={__name:"CategoryCreate",setup(re){const P=N(),j=T(),n=I(),d=O(!1),s=S({}),r=S({name:"",description:"",color:"#3B82F6",sort_order:0});$(()=>r.color,i=>{(!i||!/^#[0-9A-F]{6}$/i.test(i))&&(r.color="#3B82F6")},{immediate:!0});const D=()=>(s.name="",s.description="",s.color="",r.name.trim()?r.name.trim().length<2?(s.name="Category name must be at least 2 characters",!1):r.name.trim().length>255?(s.name="Category name must not exceed 255 characters",!1):r.description&&r.description.trim().length>0&&r.description.trim().length>1e3?(s.description="Description must not exceed 1000 characters",!1):((!r.color||!/^#[0-9A-F]{6}$/i.test(r.color))&&(r.color="#3B82F6"),!0):(s.name="Category name is required",!1)),U=async()=>{var i,e,c,a,C,x,v,h,w,k,_,F,E;if(D()){d.value=!0;try{(!r.color||!/^#[0-9A-F]{6}$/i.test(r.color))&&(r.color="#3B82F6");const t={name:r.name.trim(),description:r.description.trim()||null,color:r.color,sort_order:r.sort_order||0};console.log("CategoryCreate: Form state before submission:",{...r}),console.log("CategoryCreate: Category data to be sent:",t),console.log("CategoryCreate: Color field value:",t.color),console.log("CategoryCreate: Color field type:",typeof t.color),console.log("CategoryCreate: API endpoint will be: POST /api/categories"),console.log("CategoryCreate: Auth token:",localStorage.getItem("auth_token"));const l=await j.createCategory(t);console.log("CategoryCreate: Response received:",l),console.log("CategoryCreate: Category created successfully, showing success message"),n.success("Category created successfully!"),console.log("CategoryCreate: Success toast shown, redirecting to dashboard"),setTimeout(()=>{P.push("/dashboard")},1e3)}catch(t){if(console.error("CategoryCreate: Error creating category:",t),console.error("CategoryCreate: Error response:",t.response),console.error("CategoryCreate: Error status:",(i=t.response)==null?void 0:i.status),console.error("CategoryCreate: Error data:",(e=t.response)==null?void 0:e.data),console.error("CategoryCreate: Error message:",t.message),console.error("CategoryCreate: Full error object:",t),((c=t.response)==null?void 0:c.status)===404)n.error("Category endpoint not found. Please check backend routes.");else if(((a=t.response)==null?void 0:a.status)===401)n.error("Authentication failed. Please log in again.");else if(((C=t.response)==null?void 0:C.status)===403)n.error("Access denied. You do not have permission to create categories.");else if(((x=t.response)==null?void 0:x.status)===422)if((h=(v=t.response)==null?void 0:v.data)!=null&&h.errors){const l=t.response.data.errors;console.log("CategoryCreate: Validation errors received:",l),Object.keys(l).forEach(V=>{s[V]=l[V][0]}),n.error("Please fix the validation errors below.")}else n.error("Validation failed. Please check your input.");else((w=t.response)==null?void 0:w.status)>=500?n.error("Server error. Please try again later."):(_=(k=t.response)==null?void 0:k.data)!=null&&_.errors?Object.keys(t.response.data.errors).forEach(l=>{s[l]=t.response.data.errors[l][0]}):(E=(F=t.response)==null?void 0:F.data)!=null&&E.message?n.error(t.response.data.message):n.error(`Failed to create category: ${t.message}`)}finally{d.value=!1}}};return(i,e)=>{const c=q("router-link");return u(),m("div",R,[o("div",G,[o("div",H,[o("div",J,[e[6]||(e[6]=o("div",null,[o("h1",{class:"text-3xl font-bold text-gray-900"},"Create Category"),o("p",{class:"mt-2 text-sm text-gray-600"},"Add a new category to organize your courses")],-1)),B(c,{to:"/dashboard",class:"btn btn-secondary"},{default:A(()=>e[5]||(e[5]=[b(" Back to Dashboard ",-1)])),_:1,__:[5]})])]),o("div",K,[o("form",{onSubmit:M(U,["prevent"]),class:"p-6 space-y-6"},[o("div",null,[e[7]||(e[7]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Category Name *",-1)),p(o("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>r.name=a),type:"text",required:"",class:z(["w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",{"border-red-500":s.name}]),placeholder:"Enter category name"},null,2),[[g,r.name]]),s.name?(u(),m("p",L,y(s.name),1)):f("",!0)]),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Description",-1)),p(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=a=>r.description=a),rows:"4",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"Enter category description (optional)"},null,512),[[g,r.description]]),s.description?(u(),m("p",Y,y(s.description),1)):f("",!0)]),o("div",null,[e[9]||(e[9]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Color",-1)),o("div",Q,[p(o("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>r.color=a),type:"color",class:"w-12 h-10 border border-gray-300 rounded-md cursor-pointer"},null,512),[[g,r.color]]),p(o("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>r.color=a),type:"text",class:"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"#3B82F6"},null,512),[[g,r.color]])]),s.color?(u(),m("p",W,y(s.color),1)):f("",!0),e[10]||(e[10]=o("p",{class:"mt-1 text-sm text-gray-500"},"Choose a color to represent this category",-1))]),o("div",null,[e[11]||(e[11]=o("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Sort Order",-1)),p(o("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>r.sort_order=a),type:"number",min:"0",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",placeholder:"0"},null,512),[[g,r.sort_order,void 0,{number:!0}]]),e[12]||(e[12]=o("p",{class:"mt-1 text-sm text-gray-500"},"Lower numbers appear first in lists",-1))]),o("div",X,[B(c,{to:"/dashboard",class:"btn btn-secondary"},{default:A(()=>e[13]||(e[13]=[b(" Cancel ",-1)])),_:1,__:[13]}),o("button",{type:"submit",disabled:d.value,class:"btn btn-primary"},[d.value?(u(),m("span",ee)):f("",!0),b(" "+y(d.value?"Creating...":"Create Category"),1)],8,Z)])],32)])])])}}};export{te as default};
