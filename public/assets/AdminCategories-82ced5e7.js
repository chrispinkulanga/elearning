import{u as U,r as g,G as P,H as O,o as H,i as c,c as m,b as e,t as d,e as C,I as k,q as X,J as N,K as S,n as A,d as E,Q as I,j as $,M as J,k as j,F as q,p as L,s as Y}from"./index-367fd436.js";import{r as Z,a as ee}from"./XMarkIcon-802faa26.js";import{r as te,a as se}from"./PlusIcon-88199c76.js";import{r as oe,a as re}from"./ChevronRightIcon-f49e6b53.js";const ae={class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},le={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},ie={class:"mt-3"},ne={class:"flex justify-between items-center mb-4"},de={class:"text-lg font-medium text-gray-900"},ce={key:0,class:"mt-1 text-sm text-red-600"},ue={key:0,class:"mt-1 text-sm text-red-600"},me={key:0,class:"mt-1 text-sm text-red-600"},pe={class:"mt-2 flex items-center gap-2"},ge={class:"flex gap-3 pt-4"},xe=["disabled"],ye={key:0,class:"inline-flex items-center"},be={key:1},ve={__name:"CategoryModal",props:{category:{type:Object,default:null},isEdit:{type:Boolean,default:!1}},emits:["close","saved"],setup(M,{emit:T}){const p=M,b=T,D=U(),x=J(),y=g(!1),l=P({name:"",description:"",color:"#1976d2"}),n=P({name:"",description:"",color:""}),w={name:s=>s.trim()?s.length<2?"Name must be at least 2 characters":"":"Name is required",description:s=>s.trim()?s.length<10?"Description must be at least 10 characters":"":"Description is required",color:s=>s.trim()?/^#[0-9A-F]{6}$/i.test(s)?"":"Color must be a valid hex code (e.g., #1976d2)":"Color is required"},v=()=>{let s=!0;return Object.keys(n).forEach(o=>{n[o]=""}),Object.keys(w).forEach(o=>{const u=w[o](l[o]);u&&(n[o]=u,s=!1)}),s},i=async()=>{if(v())try{y.value=!0;const s=p.isEdit?`/api/admin/categories/${p.category.id}`:"/api/admin/categories",o=p.isEdit?"PUT":"POST",u=await fetch(s,{method:o,headers:{Authorization:`Bearer ${D.token}`,"Content-Type":"application/json"},body:JSON.stringify(l)});if(!u.ok){const z=await u.json();throw new Error(z.message||"Failed to save category")}x.success(`Category ${p.isEdit?"updated":"created"} successfully!`),b("saved")}catch(s){console.error("Error saving category:",s),x.error(s.message||"Failed to save category")}finally{y.value=!1}},f=()=>{l.name="",l.description="",l.color="#1976d2",Object.keys(n).forEach(s=>{n[s]=""})};return O(()=>p.category,s=>{s?(l.name=s.name||"",l.description=s.description||"",l.color=s.color||"#1976d2"):f()},{immediate:!0}),H(()=>{p.category&&(l.name=p.category.name||"",l.description=p.category.description||"",l.color=p.category.color||"#1976d2")}),(s,o)=>(c(),m("div",ae,[e("div",le,[e("div",ie,[e("div",ne,[e("h3",de,d(M.isEdit?"Edit Category":"Add New Category"),1),e("button",{onClick:o[0]||(o[0]=u=>s.$emit("close")),class:"text-gray-400 hover:text-gray-600"},[C(k(Z),{class:"w-6 h-6"})])]),e("form",{onSubmit:X(i,["prevent"]),class:"space-y-4"},[e("div",null,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Category Name * ",-1)),N(e("input",{"onUpdate:modelValue":o[1]||(o[1]=u=>l.name=u),type:"text",required:"",class:A(["w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":n.name}])},null,2),[[S,l.name]]),n.name?(c(),m("p",ce,d(n.name),1)):E("",!0)]),e("div",null,[o[6]||(o[6]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Description * ",-1)),N(e("textarea",{"onUpdate:modelValue":o[2]||(o[2]=u=>l.description=u),required:"",rows:"3",class:A(["w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":n.description}])},null,2),[[S,l.description]]),n.description?(c(),m("p",ue,d(n.description),1)):E("",!0)]),e("div",null,[o[8]||(o[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Color (hex code) * ",-1)),N(e("input",{"onUpdate:modelValue":o[3]||(o[3]=u=>l.color=u),type:"text",required:"",placeholder:"#1976d2",class:A(["w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",{"border-red-500":n.color}])},null,2),[[S,l.color]]),n.color?(c(),m("p",me,d(n.color),1)):E("",!0),e("div",pe,[e("div",{class:"w-4 h-4 rounded-full border border-gray-300",style:I({backgroundColor:l.color||"#1976d2"})},null,4),o[7]||(o[7]=e("span",{class:"text-sm text-gray-500"},"Preview",-1))])]),e("div",ge,[e("button",{type:"button",onClick:o[4]||(o[4]=u=>s.$emit("close")),class:"flex-1 px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Cancel "),e("button",{type:"submit",disabled:y.value,class:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed"},[y.value?(c(),m("span",ye,[o[9]||(o[9]=e("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),$(" "+d(M.isEdit?"Updating...":"Creating..."),1)])):(c(),m("span",be,d(M.isEdit?"Update":"Create"),1))],8,xe)])],32)])])]))}},fe={class:"flex justify-end mb-6"},he={class:"grid grid-cols-2 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6"},we={class:"bg-white rounded-lg shadow p-3 sm:p-6"},_e={class:"text-xl sm:text-3xl font-bold text-gray-900"},Ce={class:"bg-white rounded-lg shadow p-3 sm:p-6"},ke={class:"text-xl sm:text-3xl font-bold text-gray-900"},$e={class:"bg-white rounded-lg shadow p-6 mb-6"},Ee={class:"flex gap-4"},Me={class:"flex-1"},De={class:"bg-white rounded-lg shadow overflow-hidden"},je={class:"overflow-x-auto"},Ve={class:"min-w-full divide-y divide-gray-200"},Te={class:"bg-white divide-y divide-gray-200"},Ne={key:0,class:"animate-pulse"},Se={key:1,class:"text-center"},Ae={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ze={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"flex items-center gap-2"},Be={class:"text-sm font-medium text-gray-900"},Pe={class:"px-6 py-4 text-sm text-gray-900 max-w-xs truncate"},qe={class:"px-6 py-4 whitespace-nowrap"},Le={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ue={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Oe={class:"px-6 py-4 whitespace-nowrap text-sm font-medium"},He={class:"flex gap-2"},Ie=["onClick"],Je=["onClick"],Ge={key:0,class:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"},Ke={class:"flex-1 flex justify-between sm:hidden"},Qe=["disabled"],Re=["disabled"],We={class:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"},Xe={class:"text-sm text-gray-700"},Ye={class:"font-medium"},Ze={class:"font-medium"},et={class:"font-medium"},tt={class:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px"},st=["disabled"],ot=["onClick"],rt=["disabled"],at={key:1,class:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50"},lt={class:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"},it={class:"mt-3 text-center"},nt={class:"text-sm text-gray-500 mb-6"},dt={class:"flex gap-3 justify-center"},V=10,gt={__name:"AdminCategories",setup(M){const T=U(),p=J(),b=g([]),D=g(!1),x=g(""),y=g(!1),l=g(!1),n=g(!1),w=g(null),v=g(null),i=g(1),f=j(()=>x.value?b.value.filter(r=>r.name.toLowerCase().includes(x.value.toLowerCase())||r.description.toLowerCase().includes(x.value.toLowerCase())):b.value),s=j(()=>Math.ceil(f.value.length/V)),o=j(()=>{const r=(i.value-1)*V,t=r+V;return f.value.slice(r,t)}),u=j(()=>{const r=[];let h=Math.max(1,i.value-Math.floor(2.5)),a=Math.min(s.value,h+5-1);a-h+1<5&&(h=Math.max(1,a-5+1));for(let _=h;_<=a;_++)r.push(_);return r}),z=j(()=>b.value.reduce((r,t)=>r+(t.courses_count||0),0)),F=async()=>{try{D.value=!0;const r=await fetch("/api/categories",{headers:{Authorization:`Bearer ${T.token}`,"Content-Type":"application/json"}});if(!r.ok)throw new Error("Failed to fetch categories");const t=await r.json();b.value=t.data||[]}catch(r){console.error("Error fetching categories:",r),p.error("Failed to fetch categories")}finally{D.value=!1}},G=r=>{w.value={...r},l.value=!0},K=r=>{v.value=r,n.value=!0},Q=async()=>{if(v.value)try{if(!(await fetch(`/api/admin/categories/${v.value.id}`,{method:"DELETE",headers:{Authorization:`Bearer ${T.token}`,"Content-Type":"application/json"}})).ok)throw new Error("Failed to delete category");p.success("Category deleted successfully"),await F(),n.value=!1,v.value=null}catch(r){console.error("Error deleting category:",r),p.error("Failed to delete category")}},B=()=>{y.value=!1,l.value=!1,w.value=null},R=async()=>{await F(),B()},W=r=>r?new Date(r).toLocaleDateString():"N/A";return O(x,()=>{i.value=1}),H(()=>{F()}),(r,t)=>{var h;return c(),m("div",null,[e("div",fe,[e("button",{onClick:t[0]||(t[0]=a=>y.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2"},[C(k(te),{class:"w-5 h-5"}),t[7]||(t[7]=$(" Add Category ",-1))])]),e("div",he,[e("div",we,[t[8]||(t[8]=e("p",{class:"text-gray-600 text-xs sm:text-sm mb-2"},"Total Categories",-1)),e("p",_e,d(b.value.length),1)]),e("div",Ce,[t[9]||(t[9]=e("p",{class:"text-gray-600 text-xs sm:text-sm mb-2"},"Total Courses",-1)),e("p",ke,d(z.value),1)])]),e("div",$e,[e("div",Ee,[e("div",Me,[N(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>x.value=a),type:"text",placeholder:"Search categories...",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[S,x.value]])])])]),e("div",De,[e("div",je,[e("table",Ve,[t[12]||(t[12]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," ID "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Name "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Description "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Courses "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Created "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Actions ")])],-1)),e("tbody",Te,[D.value?(c(),m("tr",Ne,t[10]||(t[10]=[e("td",{colspan:"6",class:"px-6 py-4"},[e("div",{class:"h-4 bg-gray-200 rounded"})],-1)]))):f.value.length===0?(c(),m("tr",Se,t[11]||(t[11]=[e("td",{colspan:"6",class:"px-6 py-4 text-gray-500"}," No categories found ",-1)]))):(c(!0),m(q,{key:2},L(o.value,a=>(c(),m("tr",{key:a.id,class:"hover:bg-gray-50"},[e("td",Ae,d(a.id),1),e("td",ze,[e("div",Fe,[e("div",{class:"w-4 h-4 rounded-full",style:I({backgroundColor:a.color||"#1976d2"})},null,4),e("span",Be,d(a.name),1)])]),e("td",Pe,d(a.description),1),e("td",qe,[e("span",Le,d(a.courses_count||0),1)]),e("td",Ue,d(W(a.created_at)),1),e("td",Oe,[e("div",He,[e("button",{onClick:_=>G(a),class:"text-indigo-600 hover:text-indigo-900"},[C(k(se),{class:"w-4 h-4"})],8,Ie),e("button",{onClick:_=>K(a),class:"text-red-600 hover:text-red-900"},[C(k(ee),{class:"w-4 h-4"})],8,Je)])])]))),128))])])]),s.value>1?(c(),m("div",Ge,[e("div",Ke,[e("button",{onClick:t[2]||(t[2]=a=>i.value=Math.max(1,i.value-1)),disabled:i.value===1,class:"relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Previous ",8,Qe),e("button",{onClick:t[3]||(t[3]=a=>i.value=Math.min(s.value,i.value+1)),disabled:i.value===s.value,class:"ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}," Next ",8,Re)]),e("div",We,[e("div",null,[e("p",Xe,[t[13]||(t[13]=$(" Showing ",-1)),e("span",Ye,d((i.value-1)*V+1),1),t[14]||(t[14]=$(" to ",-1)),e("span",Ze,d(Math.min(i.value*V,f.value.length)),1),t[15]||(t[15]=$(" of ",-1)),e("span",et,d(f.value.length),1),t[16]||(t[16]=$(" results ",-1))])]),e("div",null,[e("nav",tt,[e("button",{onClick:t[4]||(t[4]=a=>i.value=Math.max(1,i.value-1)),disabled:i.value===1,class:"relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[C(k(oe),{class:"h-5 w-5"})],8,st),(c(!0),m(q,null,L(u.value,a=>(c(),m("button",{key:a,onClick:_=>i.value=a,class:A([a===i.value?"z-10 bg-blue-50 border-blue-500 text-blue-600":"bg-white border-gray-300 text-gray-500 hover:bg-gray-50","relative inline-flex items-center px-4 py-2 border text-sm font-medium"])},d(a),11,ot))),128)),e("button",{onClick:t[5]||(t[5]=a=>i.value=Math.min(s.value,i.value+1)),disabled:i.value===s.value,class:"relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},[C(k(re),{class:"h-5 w-5"})],8,rt)])])])])):E("",!0)]),y.value||l.value?(c(),Y(ve,{key:0,category:w.value,"is-edit":l.value,onClose:B,onSaved:R},null,8,["category","is-edit"])):E("",!0),n.value?(c(),m("div",at,[e("div",lt,[e("div",it,[t[17]||(t[17]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Confirm Delete",-1)),e("p",nt,' Are you sure you want to delete category "'+d((h=v.value)==null?void 0:h.name)+'"? This action cannot be undone. ',1),e("div",dt,[e("button",{onClick:t[6]||(t[6]=a=>n.value=!1),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400"}," Cancel "),e("button",{onClick:Q,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700"}," Delete ")])])])])):E("",!0)])}}};export{gt as default};
